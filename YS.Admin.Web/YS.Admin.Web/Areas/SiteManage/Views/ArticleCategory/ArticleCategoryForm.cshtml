@{
	Layout = "~/Areas/System/Views/Shared/_FormWhite.cshtml";
}
@inject Microsoft.AspNetCore.Hosting.IWebHostEnvironment HostingEnvironment
@section header {
	@*    <link href="@Url.Content("~/lib/summernote/0.8.15/summernote.min.css")" rel="stylesheet" type="text/css">
    <script src='@Url.Content("~/lib/summernote/0.8.15/summernote.js")' type="text/javascript"></script>
    <script src='@Url.Content("~/lib/summernote/0.8.15/lang/summernote-zh-CN.min.js")' type="text/javascript"></script>*@

	@BundlerHelper.Render(HostingEnvironment.ContentRootPath, Url.Content("~/lib/imageupload/1.0/css/imgup.min.css"))
	@BundlerHelper.Render(HostingEnvironment.ContentRootPath, Url.Content("~/lib/imageupload/1.0/js/imgup.min.js"))

	@*    @BundlerHelper.Render(HostingEnvironment.ContentRootPath, Url.Content("~/lib/bootstrap.tagsinput/0.8.0/bootstrap-tagsinput.min.css"))
    @BundlerHelper.Render(HostingEnvironment.ContentRootPath, Url.Content("~/lib/bootstrap.tagsinput/0.8.0/bootstrap-tagsinput.min.js"))*@
}
<div class="wrapper animated fadeInRight">
	<form id="form" class="form-horizontal m">
		<div class="form-group">
			<label class="col-sm-2 control-label ">所属父类别</label>
			<div class="col-sm-10">
				<div id="parentId" col="ParentId"></div>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label ">是否隐藏 </label>
			<div class="col-sm-10">
				<div class="col-sm-10" id="islock" col="IsLock"></div>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label ">栏目名称<font class="red"> *</font></label>
			<div class="col-sm-10">
				<input id="title" col="Title" type="text" class="form-control" />
			</div>
		</div>
		@*        <div class="form-group">
		<label class="col-sm-2 control-label ">模板选择<font class="red"> *</font></label>
		<div class="col-sm-10">
		<div id="modelid" col="ModelId"></div>
		</div>
		</div> *@
		<div class="form-group">
			@* 	<label class="col-sm-2 control-label ">发布时间<font class="red"> *</font></label>
			<div class="col-sm-4">
			<input id="baseCreateTime" col="BaseCreateTime" type="text" class="form-control" />
			</div> *@
			<label class="col-sm-2 control-label ">排序数字</label>
			<div class="col-sm-4">
				<input id="sortId" col="SortId" type="text" class="form-control" />
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label ">URL连接</label>
			<div class="col-sm-10">
				<input id="linkUrl" col="LinkUrl" type="text" class="form-control" />
			</div>
		</div>

		<div class="form-group">
			<label class="col-sm-2 control-label">对应模版</label>
			<div class="col-sm-10" id="templateId" col="TemplateId"></div>
		</div>

		<div class="form-group">
			<label class="col-sm-2 control-label ">栏目图片</label>
			<div class="col-sm-10">
				@*<input id="imgUrl" col="ImgUrl" type="text" class="form-control" />*@
				<div id="thumbImage" class="img-box">
				</div>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label ">栏目图片2</label>
			<div class="col-sm-10">
				<div id="thumbImage2" class="img-box">
				</div>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label ">栏目Banner图片</label>
			<div class="col-sm-10">
				<div id="thumbImage3" class="img-box">
				</div>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label ">栏目Banner URL连接</label>
			<div class="col-sm-10">
				<input id="bannerLinkUrl" col="BannerLinkUrl" type="text" class="form-control" />
			</div>
		</div>

		<div class="form-group">
			<label class="col-sm-2 control-label ">描述</label>
			<div class="col-sm-10">
				<textarea id="remarks" col="Remarks" class="form-control" rows="4" maxlength="200"></textarea>
			</div>
		</div>

		<div class="form-group">
			<label class="col-sm-2 control-label ">SEO标题</label>
			<div class="col-sm-10">
				<input id="seoTitle" col="SeoTitle" type="text" class="form-control" />
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label ">SEO关键字</label>
			<div class="col-sm-10">
				<input id="seoKeywords" col="SeoKeywords" type="text" class="form-control" />
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label ">SEO描述</label>
			<div class="col-sm-10">
				<input id="seoDescription" col="SeoDescription" type="text" class="form-control" />
			</div>
		</div>
	</form>
</div>

<script type="text/javascript">
	var id = ys.request("id");
	// laydate.render({ elem: '#baseCreateTime', type: 'datetime', format: 'yyyy-MM-dd HH:mm:ss', value: new Date() });
	/* var defaultmodel=top.getDataDict("sysWebModel");//{DictKey: 1, DictValue: '无类型', ListClass: '', DictStatus: 1, IsDefault: 0,  Remark: ''};*/
	// defaultmodel.unshift({DictKey: 0, DictValue: '无类型', ListClass: '', DictStatus: 1, IsDefault: 0, Remark:''})
	$(function () {
		$('#parentId').ysComboBoxTree(
			{ url: '@Url.Content("~/SiteManage/ArticleCategory/GetArticleCategoryTreeListJson")', async: false }
		);



		$("#templateId").ysRadioBox({
			url: '@Url.Content("~/SiteManage/ArticlesTemplate/GetListJson")',
			key: "Id",
			value: "TemplateName"
		});

		$("#islock").ysRadioBox({ data: ys.getJson(@Html.Raw(typeof(IsEnum).EnumToDictionaryString())) });
		//   $("#modelid").ysRadioBox({
		//     data: defaultmodel,
		//     key: "DictKey",
		//     value: "DictValue",
		//     class: "form-control"
		// });

		$("#thumbImage").imageUpload({ uploadImage: 'uploadThumbImage', limit: 1, context: ctx });
		$("#thumbImage2").imageUpload({ uploadImage: 'uploadThumbImage', limit: 1, context: ctx });
		$("#thumbImage3").imageUpload({ uploadImage: 'uploadThumbImage', limit: 1, context: ctx });


		getForm();

		$('#form').validate({
			rules: {
				title: { required: true },
				addTime: { required: true },
				sortId: { required: true },
			}
		});
	});

	function getForm() {
		if (id > 0) {
			ys.ajax({
				url: '@Url.Content("~/SiteManage/ArticleCategory/GetFormJson")' + '?id=' + id,
				type: 'get',
				success: function (obj) {
					if (obj.Tag == 1) {
						// obj.Data.AddTime = ys.formatDate(obj.Data.AddTime, "yyyy-MM-dd HH:mm:ss");
						$('#form').setWebControls(obj.Data);
						$("#thumbImage").imageUpload("setImageUrl", obj.Data.ImgUrl);
						$("#thumbImage2").imageUpload("setImageUrl", obj.Data.ImgUrl2);
						$("#thumbImage3").imageUpload("setImageUrl", obj.Data.ImgUrl3);
					}
				}
			});
		}
		else {
			var defaultData = { IsLock: 0, ModelId: 0 };
			// defaultData.AddTime = '@DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")';
			defaultData.SortId = 99;
			$('#form').setWebControls(defaultData);
		}
	}

	function saveForm(index) {
		if ($('#form').validate().form()) {
			var postData = $('#form').getWebControls({ Id: id });
			postData.ParentId = ys.getLastValue(postData.ParentId);
			postData.ImgUrl = $("#thumbImage").imageUpload("getImageUrl");
			postData.ImgUrl2 = $("#thumbImage2").imageUpload("getImageUrl");
			postData.ImgUrl3 = $("#thumbImage3").imageUpload("getImageUrl");
			ys.ajax({
				url: '@Url.Content("~/SiteManage/ArticleCategory/SaveFormJson")',
				type: 'post',
				data: postData,
				success: function (obj) {
					if (obj.Tag == 1) {
						ys.msgSuccess(obj.Message);
						parent.searchGrid();
						parent.layer.close(index);
					}
					else {
						ys.msgError(obj.Message);
					}
				}
			});
		}
	}

	function uploadThumbImage(file, callback) {
		var formdata = new FormData();
		formdata.append("fileList", file[0]);
		ys.ajaxUploadFile({
			url: '/File/UploadFile?fileModule=@UploadFileType.News.ParseToInt()',
			data: formdata,
			success: function (obj) {
				if (obj.Tag == 1) {
					if (callback) {
						callback( obj.Data);
					}
				}
				else {
					ys.msgError(obj.Message);
				}
			}
		})
	}
</script>

